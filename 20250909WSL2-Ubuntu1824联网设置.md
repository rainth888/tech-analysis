结论先说：**这套 `~/.bashrc` 思路在 WSL2 的 Ubuntu 24.04 里同样可行**（按默认 NAT 网络）。不过你这份配置里有几点可优化/踩坑需要修正，给你一份“稳健版模板”和验证&排错清单。

---

## 你这份配置里需要注意的几点

1. **重复/覆盖**
   你先写了固定 IP：

```bash
export http_proxy="http://192.168.110.67:7890"
export https_proxy="http://192.168.110.67:7890"
```

后面又用默认网关 `GW=` 覆盖了同名变量。最终生效的是**后者**。建议保留一种来源，并设置**回退**。

2. **`ftp_proxy` 指向 127.0.0.1**
   WSL2 内部的 `127.0.0.1` 是 **WSL 自己**，不是 Windows。除非你的代理工具真的在 WSL 里跑，否则会连不上。建议与 `GW` 保持一致。

3. **`ALL_PROXY`/大小写**
   很多工具识别 `ALL_PROXY`，有些识别大写，有些识别小写（curl 两者都认）。建议**大小写都导出**，提升兼容性。

4. **`no_proxy`**
   建议把 **WSL 常见网段**、`.wsl`、`host.docker.internal` 也加上，减少环回代理导致的奇怪问题。

---

## 推荐的稳健版 `~/.bashrc`（Ubuntu 18.04/24.04/WSL2 通用）
```
vim ~/.bashrc
source ~/.bashrc
```

```bash
# ---------- WSL2 auto-proxy (robust) ----------
# 1) 取默认网关（WSL2 -> Windows 宿主）
GW="$(ip route 2>/dev/null | awk '/default/ {print $3; exit}')"

# 2) 代理端口（按你的工具改）
PROXY_PORT=7890

# 3) 如果 GW 存在，就用 GW；否则可回退到静态 IP（可选）
#    如果你已知宿主固定 IP，可把 FALLBACK_HOST 改成 192.168.x.x
FALLBACK_HOST=""  # 例如：FALLBACK_HOST="192.168.110.67"

HOST_FOR_PROXY="$GW"
if [ -z "$HOST_FOR_PROXY" ] && [ -n "$FALLBACK_HOST" ]; then
  HOST_FOR_PROXY="$FALLBACK_HOST"
fi

# 4) 开关函数（需要时一键 on/off）
proxy_on() {
  if [ -n "$HOST_FOR_PROXY" ]; then
    export http_proxy="http://${HOST_FOR_PROXY}:${PROXY_PORT}"
    export https_proxy="$http_proxy"
    export ftp_proxy="$http_proxy"
    export all_proxy="$http_proxy"
    export HTTP_PROXY="$http_proxy"
    export HTTPS_PROXY="$http_proxy"
    export FTP_PROXY="$http_proxy"
    export ALL_PROXY="$http_proxy"
    # no_proxy：本机/内网/WSL常见域
    export no_proxy="localhost,127.0.0.1,::1,.local,.wsl,host.docker.internal,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
    export NO_PROXY="$no_proxy"
  else
    echo "[proxy_on] 未找到宿主机网关且未配置 FALLBACK_HOST，未设置代理变量。" >&2
  fi
}

proxy_off() {
  unset http_proxy https_proxy ftp_proxy all_proxy HTTP_PROXY HTTPS_PROXY FTP_PROXY ALL_PROXY
  unset no_proxy NO_PROXY
  echo "[proxy_off] 已清除代理环境变量。"
}

# 默认自动开（如不想默认开，可注释下一行）
proxy_on

# ---------- 你的交叉编译器PATH ----------
export PATH="$PATH:/mnt/e/_gk72010300/sdk/tools/toolchains/arm-gcc7.3-linux-musleabi/bin"
```

> 小贴士：如果你的代理工具支持 `socks5h`，也可以把 `ALL_PROXY` 改成 `socks5h://$HOST:$PORT`（域名解析走代理，更稳）。

---

## 验证是否生效

1. **看变量**

```bash
echo $http_proxy
echo $no_proxy
```

2. **连通性（域名解析 + HTTP 请求）**

```bash
curl -I http://www.baidu.com
curl -I https://www.google.com    # 如需走代理场景
```

3. **检查当前默认网关**

```bash
ip route | sed -n '1,2p'
```

如 `curl` 能返回 200/302 等响应头，网络就通了。

---

## apt / git / npm 等工具的代理

* **apt**（需要系统级走代理时，才配置；否则继承环境变量即可）：

  ```bash
  sudo mkdir -p /etc/apt/apt.conf.d
  printf 'Acquire::http::Proxy "%s";\nAcquire::https::Proxy "%s";\n' \
    "$http_proxy" "$https_proxy" | sudo tee /etc/apt/apt.conf.d/99proxy
  ```

  取消时：`sudo rm /etc/apt/apt.conf.d/99proxy`

* **git**：

  ```bash
  git config --global http.proxy  "$http_proxy"
  git config --global https.proxy "$https_proxy"
  # 取消：git config --global --unset http.proxy
  ```

* **npm**：

  ```bash
  npm config set proxy  "$http_proxy"
  npm config set https-proxy "$https_proxy"
  # 取消：npm config delete proxy ; npm config delete https-proxy
  ```

---

## Ubuntu 24.04 在 WSL2 的差异点（你可能会遇到）

* **systemd 默认启用**：24.04 在 WSL2 中多为开启 systemd，服务管理（如 `systemctl`）可用；这不影响代理变量用法。
* **`/etc/resolv.conf`** 由 WSL 管理，如果你曾手改 DNS，建议恢复默认（或在 Windows 端修复网络后 `wsl --shutdown` 再重进）。
* **`host.docker.internal` 可用**：在 WSL2 新版里基本可解析为宿主机，作为代理主机名也可一试：

  ```bash
  export http_proxy="http://host.docker.internal:7890"
  ```

---

## 常见故障排查

* 代理开了但还是不通：

  * 你的代理工具是否真的监听在 **宿主机网卡**（0.0.0.0）而不是仅 127.0.0.1？
  * 端口对吗？（7890/1080 等）
  * Windows 防火墙是否允许该程序对局域网监听？
  * 在 WSL 里 `curl http://$GW:7890` 看看有无响应（如返回错误也代表端口可达）。

* 只有 `ping` 域名失败：

  * `ping` 用 ICMP，与 HTTP 代理无关，**用 `curl` 验证**更准确。
  * DNS 问题时可试临时指定：

    ```bash
    sudo bash -c 'echo "nameserver 8.8.8.8" > /etc/resolv.conf'
    # 之后 wsl --shutdown 再进 可能会被重置；如要长期改，用 wsl.conf 管理
    ```

---

### 小结

* 你的这套 **“取默认网关 + 导出代理变量”** 的方法在 Ubuntu 24.04 / WSL2 下依然适用；
* 调整为上面的“稳健版模板”，避免 127.0.0.1 与覆盖冲突，补齐大小写与 no\_proxy；
* 用 `curl -I` 验证，比 `ping` 更符合“走代理”的实际行为。

需要我把这个模板做成一个一键脚本（附 `proxy_on`/`proxy_off` 命令），或顺带帮你配 apt/git/npm 的代理开关脚本吗？
